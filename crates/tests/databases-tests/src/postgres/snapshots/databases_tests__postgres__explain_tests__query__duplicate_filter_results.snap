---
source: crates/tests/databases-tests/src/postgres/explain_tests.rs
expression: result.details.query
---
EXPLAIN WITH "%3_Artist" AS (
  SELECT
    "%0_Artist".*
  FROM
    "public"."Artist" AS "%0_Artist"
  WHERE
    EXISTS (
      SELECT
        1
      FROM
        (
          SELECT
            "%1_BOOLEXP_Album".*
          FROM
            (
              SELECT
                *
              FROM
                "public"."Album" AS "%1_BOOLEXP_Album"
              WHERE
                (
                  "%0_Artist"."ArtistId" = "%1_BOOLEXP_Album"."ArtistId"
                )
            ) AS "%1_BOOLEXP_Album"
        ) AS "%2_BOOLEXP_Album"
      WHERE
        (
          "%2_BOOLEXP_Album"."Title" ~~ cast($1 as "pg_catalog"."varchar")
        )
    )
  ORDER BY
    "%0_Artist"."ArtistId" ASC
  LIMIT
    5
)
SELECT
  coalesce(json_agg(row_to_json("%5_universe")), '[]') AS "universe"
FROM
  (
    SELECT
      *
    FROM
      (
        SELECT
          coalesce(json_agg(row_to_json("%6_rows")), '[]') AS "rows"
        FROM
          (
            SELECT
              "%4_Artist"."Name" AS "Name"
            FROM
              "%3_Artist" AS "%4_Artist"
            ORDER BY
              "%4_Artist"."ArtistId" ASC
          ) AS "%6_rows"
      ) AS "%6_rows"
  ) AS "%5_universe"
