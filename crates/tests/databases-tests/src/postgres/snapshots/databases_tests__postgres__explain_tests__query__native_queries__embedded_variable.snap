---
source: crates/tests/databases-tests/src/postgres/explain_tests.rs
expression: result.details.query
---
EXPLAIN
SELECT
  coalesce(json_agg("%8_universe_agg"."universe"), '[]') AS "universe"
FROM
  (
    SELECT
      row_to_json("%5_universe") AS "universe"
    FROM
      jsonb_to_recordset($1) AS "%0_%variables_table"("%variable_order" "int4", "%variables" "jsonb")
      CROSS JOIN LATERAL (
        WITH "%2_NATIVE_QUERY_album_by_title" AS (
          WITH "%9_NATIVE_QUERY_album_by_title" AS (
            SELECT
              *
            FROM
              public."Album"
            WHERE
              "Title" LIKE cast(
                (
                  ("%0_%variables_table"."%variables" -> $2) #>> cast(ARRAY [] as "text"[])) as "pg_catalog"."varchar") AND "AlbumId" < 500
                )
                SELECT
                  *
                FROM
                  "%9_NATIVE_QUERY_album_by_title" AS "%10_NATIVE_QUERY_album_by_title"
              ),
              "%3_album_by_title" AS (
                SELECT
                  "%1_album_by_title".*
                FROM
                  "%2_NATIVE_QUERY_album_by_title" AS "%1_album_by_title"
                ORDER BY
                  "%1_album_by_title"."AlbumId" ASC
              )
            SELECT
              *
            FROM
              (
                SELECT
                  coalesce(json_agg(row_to_json("%6_rows")), '[]') AS "rows"
                FROM
                  (
                    SELECT
                      "%4_album_by_title"."Title" AS "Title"
                    FROM
                      "%3_album_by_title" AS "%4_album_by_title"
                    ORDER BY
                      "%4_album_by_title"."AlbumId" ASC
                  ) AS "%6_rows"
              ) AS "%6_rows"
          ) AS "%5_universe"
          ORDER BY
            "%0_%variables_table"."%variable_order" ASC
        ) AS "%8_universe_agg"
